{
  "name": "AI Agent Facebook Message",
  "nodes": [
    {
      "parameters": {},
      "id": "4e58b7fc-d310-43d5-b326-884c072b06ec",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -5040,
        1152
      ]
    },
    {
      "parameters": {
        "content": "## Chia ticket cho Phương, Chi, Huy"
      },
      "id": "1b956c6f-2c49-4fbc-ab75-996c2bdc46be",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3776,
        7712
      ]
    },
    {
      "parameters": {
        "functionCode": "return items;"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -4848,
        1328
      ],
      "id": "b216c327-cc2b-45a3-8ec2-70df578aac5f"
    },
    {
      "parameters": {
        "jsCode": "return{\n\n\n    \"headers\": {\n      \"host\": \"workflow.cloodo.com\",\n      \"user-agent\": \"axios/1.7.9\",\n      \"content-length\": \"67\",\n      \"accept\": \"application/json, text/plain, */*\",\n      \"accept-encoding\": \"gzip, compress, deflate, br\",\n      \"content-type\": \"application/json\",\n      \"x-forwarded-for\": \"207.244.255.94\",\n      \"x-forwarded-host\": \"workflow.cloodo.com\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"40c48caec682\",\n      \"x-real-ip\": \"207.244.255.94\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"senderId\": \"9328599640527653\",\n      \"message\": \"pricing\",\n      \"imageUrl\": null\n    },\n    \"webhookUrl\": \"https://workflow.cloodo.com/webhook/SJ2Az23OeQTAADDE/webhook/facebook\",\n    \"executionMode\": \"production\"\n\n\n}"
      },
      "id": "a569ef67-faad-4e8b-8eb9-6d8f04c653ed",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4816,
        1152
      ]
    },
    {
      "parameters": {
        "content": "## {{ $json.body.senderId }}\n",
        "width": 318.78827753313925
      },
      "id": "1f217567-510c-4bfe-b2d5-c93a807e7ab1",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4528,
        432
      ]
    },
    {
      "parameters": {
        "amount": 10
      },
      "id": "e2b0d42d-ea4c-4738-90ac-d508281e27c2",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -4624,
        1328
      ],
      "webhookId": "bcb53c9d-04ed-436e-a2c8-6e09fc7991dd",
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1237bc1a-1b9b-4981-9b10-1829e20f28ed",
      "name": "Get Detail list Chat User6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4208,
        1328
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/213439902114044/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $json.body.senderId }}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "cb9c6255-db96-4482-b321-b8531201db5e",
      "name": "HTTP Request5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4400,
        1328
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.messages.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to,created_time"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "89165ce3-828e-4c01-a3e3-0514fe284ac6",
      "name": "Get Detail Last list Chat User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3920,
        1328
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a4bb989a-d243-4888-87d3-773e405fa336",
              "leftValue": "={{ $json.from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "264909f4-3c00-4597-af3f-e4ba4208da7d",
              "leftValue": "={{ new Date($json.created_time.replace(' ', 'T').replace('+0000', '+07:00')).getTime() }}",
              "rightValue": "={{ new Date(Date.now() - 0.4 * 60 * 1000).getTime() }}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "39639f3b-2bb9-4b52-883a-6a93c46adaa8",
      "name": "Last send by client",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3728,
        1328
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "20268734-4e83-46f6-af76-1846a20cf59d",
      "name": "Get Tracked2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -448,
        1328
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI1']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/\"/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "cd086fcc-9227-4a87-9cbd-af59663cd4fc",
      "name": "Code8",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        368,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.email.replaceAll(/@facebook.com/g, '') }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $('Code8').item.json.output.replaceAll(/\"/g, '') }}\\nPlease provide us with your email so we can better assist you!\\nBest Regard,\\nCmsmart Ecommerce\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "a48fad9e-983f-4144-ad76-6c8b3afde42e",
      "name": "send welcome2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        832,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Dear {{ $json.participants.data[0].name }},\\nI’m reaching out regarding the email address you provided. Unfortunately, it appears that the email is incomplete or missing. Could you kindly provide the correct email address at your earliest convenience? This will help us proceed with your request smoothly.\\n Thank you for your understanding and cooperation. Please let me know if you need any assistance with this.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "719bccc2-164b-4548-ae82-f206f087138d",
      "name": "remind mail",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        944,
        800
      ]
    },
    {
      "parameters": {},
      "id": "51ccf728-15eb-416a-ad92-d94f57ed5985",
      "name": "Get CLient CMS By Email",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        688,
        448
      ],
      "credentials": {}
    },
    {
      "parameters": {},
      "id": "46ebf561-c2b4-40c0-88b0-982a85e50fcf",
      "name": "Cloodo CRM Create New Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        1168,
        368
      ],
      "credentials": {}
    },
    {
      "parameters": {},
      "id": "3234736f-9601-40b1-8567-cdbb4e526ae3",
      "name": "Create Project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        1360,
        368
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hello {{ $('Get User Facebook').item.json.participants.data[0].name }}, \\nTo provide you with the best support possible, we've created a new client account for you on our system. Please login using the email we've registered for you. For security reasons, we recommend setting a new password upon your first login. You can do this by visiting our website and following the instructions for 'Forgot Password' if needed.\\nUsername: {{ $('Take mail1').item.json.Email }} \\nPassword: x7M&dL!9wQ#2tV4% \\nVisit our system: https://worksuite.cloodo.com/ \\nIf you have any questions during the process, feel free to reach out for assistance.\\nThank you for working with us!\\nLet me know if there's anything else you need or if there's any other way I can assist you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3041abd0-abbe-4850-8596-808e208aa98c",
      "name": "send create account",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1728,
        368
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\",\n    \"email\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $('Cloodo CRM Create New Client').item.json.data.user.id }}\"\n}",
        "options": {}
      },
      "id": "3b7fee10-2ca1-4d7e-a776-6771eb98ec97",
      "name": "Update contact client2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1552,
        368
      ]
    },
    {
      "parameters": {},
      "id": "09e95aa1-539e-4185-9163-49465f3b5bc9",
      "name": "No Operation, do nothing1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2400,
        560
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\",\n    \"email\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $json.data[0].user.id }}\"\n}",
        "options": {}
      },
      "id": "6202c49e-251c-4e45-a711-f649f45217fa",
      "name": "Update contact client3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        560
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Thank you for providing the details. We’ve successfully received the information you’ve provided, and everything seems to be in order.\\nIn order to assist you further, could you kindly clarify the issue you are encountering? Please provide as much detail as possible so we can resolve it efficiently.\\nWe’re here to help, and we look forward to your response.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "2aa8a16d-e189-429b-92c5-852785cd94c4",
      "name": "send received email",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1408,
        560
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "Company": "={{ $('Get User Facebook').item.json.participants.data[1].name }}",
            "client": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "client_name": "={{ $('Get User Facebook').item.json.participants.data[0].name }}",
            "level": "1",
            "status": "open",
            "email": "={{ $('Take mail1').item.json.Email }}",
            "mailFacebook": "={{ $('Get User Facebook').item.json.participants.data[0].email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "40f51673-c16c-41ab-a5a9-26009784fb79",
      "name": "Append1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1904,
        368
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "Company": "={{ $('Get User Facebook').item.json.participants.data[1].name }}",
            "client": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "client_name": "={{ $('Get User Facebook').item.json.participants.data[0].name }}",
            "level": "1",
            "status": "open",
            "email": "={{ $('Take mail1').item.json.Email }}",
            "mailFacebook": "={{ $('Get User Facebook').item.json.participants.data[0].email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "54202ad5-64a5-4e83-bbc2-c3af6ebb059b",
      "name": "Append3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1600,
        560
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "for (const item of $('Aggregate14').all()) {\n  const mail = item?.json?.data[0]?.message;\n  console.log('arg', mail);\n\n  // Biểu thức chính quy kiểm tra email\n  const emailRegex = /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}\\b/\n  const foundEmail = mail ? mail.match(emailRegex) : null;\n\n  // Nếu có email thì gán vào myNewField, không thì trả về null\n  item.json.Email = foundEmail ? foundEmail[0] : null;\n}\n\nreturn $('Aggregate14').all();"
      },
      "id": "e36dbd57-68bc-479e-a0ee-d0859f31e9e4",
      "name": "Take mail1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        528
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2d4dda6b-c9a9-48ef-96a2-48d021bc255f",
              "leftValue": "={{ $json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d33ff840-53e6-4687-a2f5-583075c3f10d",
      "name": "mail1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        112,
        528
      ]
    },
    {
      "parameters": {},
      "id": "8d100e04-5392-4d88-a181-be39d7e5a3ac",
      "name": "Get Project CMS By Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -48,
        1328
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9fd9da20-5532-4026-8eff-b6e09856d627",
              "leftValue": "={{ $json.client.toString() }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "0b0a79e9-8523-4633-bac8-076a06133974",
      "name": "Check Client Not Tracked Before",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        224,
        1984
      ]
    },
    {
      "parameters": {},
      "id": "e7ec81ca-54c5-4a79-9233-cc47a6cde6bc",
      "name": "Get CLient CMS By Email1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -240,
        1328
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $('Update Follow').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "a952a753-52d2-4a08-9e07-64c298032474",
      "name": "Get Tracked3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        160,
        1328
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "errorMessage": "err"
      },
      "id": "7420a326-1871-4cfb-9601-23112b30e196",
      "name": "Stop and Error1",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -128,
        2432
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get User Facebook2').item.json.participants.data[0].name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "d275a9fc-1fe4-4abf-8288-6fc29b25567d",
      "name": "send welcome",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2160,
        1424
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Aggregate8').item.json.data[0].from.id }}",
            "Company": "={{ $('Aggregate6').item.json.data[0].to.data[0].name }}",
            "client": "={{ $('Aggregate6').item.json.data[0].from.id }}",
            "client_name": "={{ $('Aggregate6').item.json.data[0].from.name }}",
            "level": "1",
            "status": "open",
            "admin": "={{ $('Aggregate6').item.json.data[0].to.data[0].id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "f36578b3-798d-4bf2-8548-0ad167be36dc",
      "name": "UP Level 1 - open1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        2384,
        1424
      ],
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"MESSAGE_TAG\",\n  \"tag\": \"ACCOUNT_UPDATE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "a8808621-9ff3-43cb-ba7d-be5f0ea449fe",
      "name": "send welcome1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2544,
        1648
      ]
    },
    {
      "parameters": {},
      "id": "7e432828-b536-4528-a231-4806ff858491",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3840,
        1424
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/###/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "9c3bb533-c293-4be1-a8fb-844345218d62",
      "name": "Code9",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2352,
        1648
      ]
    },
    {
      "parameters": {},
      "id": "21b670bb-5611-4d9e-aa42-992aac81477a",
      "name": "Create Project2",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        768,
        3312
      ],
      "credentials": {}
    },
    {
      "parameters": {},
      "id": "0c0e789e-dec1-4e75-b06f-df791480af82",
      "name": "Create Task Take Care1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        992,
        3312
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Check Client Not Tracked Before').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project2').item.json.data.id }}/\\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "afbb9023-db44-4ec5-9992-e7083e634f69",
      "name": "Require Project",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1200,
        3312
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "project_name_support": "={{ $('Create Project2').item.json.data.name }}",
            "id_project_support": "={{ $('Create Project2').item.json.data.id }}",
            "status": "created_project",
            "level": "2",
            "admin": "213439902114044",
            "id": "={{ $('Check Client Not Tracked Before').item.json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "d8006edc-42fb-43c0-bb3e-b51828c93e34",
      "name": "UP Level  2 create project1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1424,
        3312
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {},
      "id": "b2607ccf-d061-4da5-bcd6-a0ca9283b47d",
      "name": "Get list project",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        2832,
        2992
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch6').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch6').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch6').all(); \n"
      },
      "id": "debeb597-cfd6-4972-9f35-a0f7f3f2b0e3",
      "name": "Code get list pro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2320,
        3360
      ]
    },
    {
      "parameters": {},
      "id": "aefeabce-86fc-4a32-9d4a-bd9711778586",
      "name": "Get list project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        2128,
        2608
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch6').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch6').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch6').all(); \n"
      },
      "id": "f6dfb25d-5eac-4ebf-a46f-80b3b2c87202",
      "name": "Code get list pro1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1712,
        2608
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "list_id_project": "={{ $('Get Project CMS By Client').item.json.data.map(item=>item.id) }}",
            "status": "ask_project",
            "level": "3",
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "50485933-b92e-4a31-94da-247c080adf9f",
      "name": "UP Level 3 - ask_project2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        944,
        2720
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "One Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c0d9bf88-52c2-4ab4-9f75-8e77387bfb33",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length > 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Many Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cf3c7e3a-eb06-4ab9-8fa5-788bedc0243d",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 0 }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Non-Project"
            }
          ]
        },
        "options": {}
      },
      "id": "d272e41b-b1c5-4f66-a416-a74c1000760e",
      "name": "Switch Quantity Project2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        560,
        2544
      ]
    },
    {
      "parameters": {
        "resource": "chat",
        "chatModel": "gpt-4o",
        "prompt": {
          "messages": [
            {
              "role": "assistant",
              "content": "=Given the list of project names provided below and the conversation messages between the client and admin, determine which project the client needs support with. Please follow these steps:\n\nReview the Project List and Conversation Messages provided below.\nFollow the chronological sequence of messages based on the \"Time Send\" timestamps.\nIf the client directly mentions a project (even partially), return only exactly the name of project follow list name project below.\nIf the client does not directly mention any project or the project cannot be identified from the conversation, return 'notfound'.\n\nProject List: {{ $json.data.map(item => `${item.name}`).join('\\n') }}\n\nConversation Messages: {{ $('Get All Messages').item.json.messagesSent }}\n"
            }
          ]
        },
        "simplifyOutput": "=true",
        "options": {
          "maxTokens": 1600
        },
        "requestOptions": {}
      },
      "id": "3a1bea64-da44-4a9e-af40-8908ea207319",
      "name": "OpenAI6",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.1,
      "position": [
        3040,
        2992
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Switch6').item.json.id }}",
            "level": "3",
            "status": "confirm_project",
            "id_project_support": "={{ $('Get Project support1').item.json.projectFound[0].id }}",
            "project_name_support": "={{ $('Get Project support1').item.json.projectFound[0].name }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {
          "useAppend": true
        }
      },
      "id": "bd3407d8-bdad-400d-853e-2ba7680f3708",
      "name": "UP Level 3 - confirm_project",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        3712,
        2992
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "let project =[]\nconst nameProjectFind = $input.all()[0].json.message.content.trim()\nfor (const item of $('Get list project').all()[0]?.json?.data) {\n  if(nameProjectFind == item?.name){\n     let projectItem ={\n    id: item?.id,\n    name: item?.name\n  }\n  project.push(projectItem)\n    break\n  }\n \n}\n\nreturn {projectFound: project};"
      },
      "id": "db9b6fdf-c41b-4ff4-b64d-6eba5b1d5103",
      "name": "Get Project support1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3248,
        2992
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get Tracked4').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"I hope you're doing well! 😊\\nIt looks like you're working on {{ $json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\\nLooking forward to hearing from you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3ca5cbbb-69cd-4a6d-ba75-24be789f7f42",
      "name": "send message6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3472,
        2992
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "9d739aa3-f2a8-4a09-8055-2e9f77f849d2",
      "name": "Split Out7",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2624,
        3360
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "5900476d-38f7-4bfc-8948-7fe23e5cb2d7",
      "name": "Split Out8",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1920,
        2608
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "db948acd-cfce-48fc-8e75-c9f9b9c5590d",
      "name": "Get Tracked4",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1152,
        2720
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {},
      "id": "1ca63d80-0585-48eb-9550-d9f1517533d0",
      "name": "No Operation, do nothing2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        4384,
        2288
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8dd5f6e1-5663-4875-9a95-0ef4f4cc4b33",
              "name": "messagesSent",
              "value": "={{ $('Get All Messages9').item.json.messagesSent }}",
              "type": "string"
            },
            {
              "id": "32b12d76-b7d0-45e2-bb6e-79e2471d3d00",
              "name": "project.name",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].name }}",
              "type": "string"
            },
            {
              "id": "6256a5cf-e613-4a5e-97cd-2a7577d602d0",
              "name": "project.status",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].status }}",
              "type": "string"
            },
            {
              "id": "507895aa-b100-48f3-91f4-b73275d561ce",
              "name": "project.start_date",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].start_date }}",
              "type": "string"
            },
            {
              "id": "6188ba61-5d09-4981-9897-9c51baebf721",
              "name": "project.deadline",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].deadline }}",
              "type": "string"
            },
            {
              "id": "21d301e8-3923-48a7-8fb6-a3a7bb808464",
              "name": "project.members",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].members }}",
              "type": "array"
            },
            {
              "id": "b6b31ed5-06b9-4d6e-b123-3a3542340022",
              "name": "client",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].client }}",
              "type": "object"
            },
            {
              "id": "597832ff-562f-437a-b31b-aa1080688fc8",
              "name": "project.milestone",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "2e6ff1ea-6500-48f3-ae73-6cf8543209a0",
              "name": "project.id",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3e5640b8-14b7-4622-842b-c1fef4081096",
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2000,
        1968
      ]
    },
    {
      "parameters": {},
      "id": "0562a3ab-73a3-4878-9215-626a89deec1f",
      "name": "Cloodo Milestone1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        1808,
        1968
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "b54e81b8-0edf-43d0-90c2-5d7a933ca7ee",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1968,
        2272
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=8db38109-d083-45b4-8cb4-60f16cd5bbf9"
      },
      "id": "7a8fa449-d713-4f88-8ac2-fd3c2a0585e6",
      "name": "Window Buffer Memory1",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2080,
        2304
      ]
    },
    {
      "parameters": {
        "name": "create_new_project",
        "description": "Call this tool to creat new project. The input should be are name of project and summary of project",
        "workflowId": {
          "__rl": true,
          "value": "ul59bchkMPmnFbMy",
          "mode": "list",
          "cachedResultName": "Messager - Create New Project"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "member_project",
              "stringValue": "={{ $('Get CLient CMS By Email1').item.json.data[0].added_by.id }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "19539095-3232-4545-b42a-85962fe5e449",
      "name": "create_new_project1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        2224,
        2384
      ]
    },
    {
      "parameters": {
        "name": "resolve_problem_ticket",
        "description": "Call this tool to resolve problem ticket when client want to support with their ticket. The input should be is number of ticket",
        "workflowId": {
          "__rl": true,
          "value": "vNXQba5R8WXZU80n",
          "mode": "list",
          "cachedResultName": "Messager - Resolve proplem of Ticket"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "858edcc7-90b0-450f-a661-08297c1e6793",
      "name": "resolve_problem_ticket1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        2544,
        2384
      ]
    },
    {
      "parameters": {
        "name": "ask_info_project",
        "description": "Call this tool to reply client when client ask about their project.\n",
        "workflowId": {
          "__rl": true,
          "value": "UO7emuUbJgzax4sw",
          "mode": "list",
          "cachedResultName": "Messager - Reply Info Project"
        },
        "fields": {
          "values": [
            {
              "name": "project_id",
              "stringValue": "={{ $json.project.id }}"
            },
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "2a50e260-d4c6-44aa-9e42-d0f9017240ff",
      "name": "ask_info_project1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        2400,
        2400
      ]
    },
    {
      "parameters": {
        "name": "take_care_client",
        "description": "Call this tool to help customers with their requests such as adding new features, processing refunds, invoice, estimate or other tasks. The input data for the request is the issue they need support for.",
        "workflowId": {
          "__rl": true,
          "value": "69ieUP8Gx9VnyEbG",
          "mode": "list",
          "cachedResultName": "Messager - Take care Client"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "project_id",
              "stringValue": "={{ $('Edit Fields1').item.json.project.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "549f5e27-8975-48dc-8ce6-2ca9d28a9d98",
      "name": "take_care_client1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        2704,
        2352
      ]
    },
    {
      "parameters": {
        "name": "summary_chat_session",
        "description": "Call this tool to perform a summary of the issues discussed with the customer during that session when the customer's issue requiring support has been resolved and the customer has no further requests. The request data is the customer's message confirming that their issue has been resolved and that there are no further requests.",
        "workflowId": {
          "__rl": true,
          "value": "1Os3kiRF9eclEf4j",
          "mode": "list",
          "cachedResultName": "Messager - Summary chat Session"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "f4a94f23-803e-4bc5-b731-a39a3db96e22",
      "name": "summary_chat_session1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        2848,
        2288
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Switch Quantity Project2').item.json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "9e552cf7-72e7-4976-a8d5-a8c814693bf8",
      "name": "send message7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3904,
        1952
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51d163c9-5926-4169-a8a7-8a0cdeb98caa",
              "leftValue": "={{ $json.messages.data[0].from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "40caa6c2-ecd2-48d9-b9ef-54a39df75781",
      "name": "Last send by Client2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3088,
        1968
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "da5b6f4b-8aba-4ae3-913c-e2fe93552ee3",
      "name": "Get Detail list Chat User11",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2880,
        1968
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['AI Agent1']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "48ac3cb8-92c9-467a-bf65-47ac890d08f5",
      "name": "Code13",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3712,
        1952
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ALWAYS use plain text and simple bullet points if need for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.\n\nAct as LiveChat AI Assistant \n\nUse the data i provide dynamically below in a way that helps analyze the client's needs and deliver personalized responses, but without directly repeating the data back to the client. You must leverage the information you've supplied to inform its conversation flow and provide insightful, helpful responses based on the client's context.\n\nInformation about client project\nProject name: {{ $json.project.name }}\nProject status: {{ $json.project.status }}\nStart date: {{ $json.project.start_date }}\nDeadline: {{ $json.project.deadline }}\nProject members: {{ $json.project.members.map(item=> item.name) }}\n\nInformation about client:\nName: {{ $json.client.name }}\nEmail: {{ $json.client.email }}\nMobile: {{ $json.client.mobile }}\n\n\nHistory chat messages:\n{{ $json.messagesSent }}\n\n\nAI Assistant Prompt with Contextual Analysis:\nGreeting the Client:\n\n\"Hello! 👋 Welcome to [Company Name]. I’m [Your AI Assistant Name], and I’m here to assist you today. How can I help you?\"\n\n(If the client hasn’t initiated the conversation yet, this greeting will prompt them to describe their needs or project.)\n\n1. If the Client Wants to Create a New Project:\nLet call to create_new_project tools\n\n2. If the Client Needs Support with a Ticket:\nLet call to resolve_problem_ticket tools\n\n3. If the Client Asks About Their Project Information (Milestones, Status, Tasks):\nLet call to ask_info_project tools\n\n4. If the Client Wants to Add a New Feature:\nLet call to take_care_client tools\n\n5. If the Client Requests a Refund or invoice:\nLet call to take_care_client tools\n\n6. Handling Last Message from Client:\nBased on your most recent message, I can see that you’re asking about [issue or request]. Let’s address that right away!\n\nFor example, if the client’s last message is about needing help with a project feature or milestone, the AI would respond:\n\n\"I noticed you're asking about [Milestone X]. Let me help you with that! Could you confirm if you're looking for updates on this milestone or if you need assistance with a specific task related to it?\"\n\n8. Wrapping Up the Chat:\n\"Thank you for sharing all of this information with me! I’ll make sure everything is updated and will send you an email confirmation shortly.\n\nIs there anything else I can assist you with while we’re still chatting?\"\n\n9. Closing the Chat:\nLet call to summary_chat_session tools\n\n\nHow the AI Uses Your Data Dynamically:\nHistory Chat Messages:\n\nThe AI reviews the client’s past messages and uses them to tailor the conversation. For example, if the client mentioned a problem earlier, the AI might start by asking if the issue has been resolved or needs further assistance.\nClient Project Information:\n\nThe AI will dynamically access the project’s name, status, and milestones (e.g., “Your project [Project Name] is currently in [Current Status] and includes milestones like [Milestone 1, Milestone 2]”). This contextualizes the conversation, allowing the AI to give specific advice or updates based on the project’s current phase.\nClient’s Last Message:\n\nThe AI will analyze the last message from the client and build the conversation around it, ensuring that it stays relevant to their current needs (e.g., \"I see you're asking about [specific feature or issue], let me help you with that!\").\n\nFinal Notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on what the client needs (creating a project, ticket support, project information, new features, or refunds).\nUse the project information you provide dynamically to craft responses, ensuring that you don’t repeat the data back verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.",
        "options": {}
      },
      "id": "d3dab20d-f351-4e18-bc24-af578c9f2221",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        2240,
        1984
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d2c20e6-0727-4f45-a578-0e63ea7d8ece",
              "leftValue": "={{ $json.messages.data[0].from.name }}",
              "rightValue": "Cmsmart Ecommerce",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "887c58ff-6b29-4fb7-8f12-353aacb9d73e",
      "name": "check cms send",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4000,
        752
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"{{ $json.inf.from.email }}\",\n      \"to\": \"{{ $json.inf.to.data[0].email }}\",\n      \"body\": \"{{ $json.output }}\",\n      \"fromMe\": false,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $json.inf.to.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "c4c9b1a2-a9ab-43c9-b511-fed253f6d94d",
      "name": "Post message lên workchat from client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3536,
        912
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "let info = $input.all()[0].json.messages?.data[1]\nlet message =  $input.all()[0].json.messages?.data[1]?.message\nconsole.log('arg: ', message)\nmessage = message.replace(/\\*/g, '')\nmessage = message.replace(/\\n\\n/g, '\\\\n\\\\n');\nmessage = message.replace(/\\n/g, '\\\\n');\nmessage = message.replace(/\"/g, '');\nreturn {\n  inf: info,\n  output: message\n};"
      },
      "id": "76c80a14-52a5-4041-b325-f39fb698f18b",
      "name": "Code14",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3776,
        912
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"{{ $json.inf.from.email }}\",\n      \"to\": \"{{ $json.inf.to.data[0].email }}\",\n      \"body\": \"{{ $json.output }}\",\n      \"fromMe\": false,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $json.inf.from.name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "530e1db5-d6f6-48b5-8792-7ae0c8341074",
      "name": "Post message lên workchat from client1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3536,
        624
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "let info = $input.all()[0].json.messages?.data[0]\nlet message =  $input.all()[0].json.messages?.data[0]?.message\nconsole.log('arg: ', message)\nmessage = message.replace(/\\*/g, '')\nmessage = message.replace(/\\n\\n/g, '\\\\n\\\\n');\nmessage = message.replace(/\\n/g, '\\\\n');\nmessage = message.replace(/\"/g, '');\nreturn {\n  inf: info,\n  output: message\n};"
      },
      "id": "54f5797a-e9d8-4ffe-aa6a-e95d00e00d5c",
      "name": "Code15",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3776,
        624
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "fc57bcd7-e0f8-49aa-ae57-fa5433f0b859",
      "name": "MySQL Get Detail Messages",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        752,
        1424
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "a2ecd03c-3595-4309-9e5c-a6f8fea1f5b9",
      "name": "MySQL Get Info Client",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        560,
        1424
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "91104961-137e-4543-8a77-cea3f4f69314",
      "name": "Aggregate13",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        944,
        1424
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate13']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.slice(0,20).reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "1b248626-2d43-4642-bae4-d934e140c4e7",
      "name": "Get All Messages7",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        1424
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client2').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client2').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client2').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client2').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "f75c02f8-35a5-4387-b921-37f168f4bf4b",
      "name": "MySQL Get Detail Messages2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -1328,
        464
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "b538c66e-12ad-412b-a5f5-724375eaf7c8",
      "name": "MySQL Get Info Client2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -1504,
        464
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "74c2b55f-a15c-49c5-ba4c-4dfdf0e28d90",
      "name": "Aggregate14",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1104,
        464
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate14']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.slice(0,5).reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "bc5e72ff-fc29-4409-bdd7-c66f0d85cde6",
      "name": "Get All Messages8",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -896,
        464
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "18ae536c-a09d-463d-88e1-ab7a1f22013e",
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "email",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "email"
            }
          ]
        },
        "options": {}
      },
      "id": "adea26ef-6a3b-443e-a8f2-8e742c1eaa20",
      "name": "Switch3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -336,
        464
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.id = {{ $('Aggregate14').item.json.data[0].user_one ? `\"${$('Aggregate14').item.json.data[0].user_one}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "181c4a40-9939-4999-908b-6078fba08b00",
      "name": "MySQL Get Info Client3",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        592,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('MySQL Get Info Client3').item.json.email }}\",\n      \"body\": \"{{ $('Code8').item.json.output.replaceAll(/\"/g, '') }}\\nPlease provide us with your email so we can better assist you!\\nBest Regard,\\nCmsmart Ecommerce\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('MySQL Get Info Client3').item.json.name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "bf12d9c3-6f58-4df0-a264-6a4137a06ee3",
      "name": "Post message lên workchat from admin",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1120,
        0
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "e27159da-e120-4c75-9a43-851ab0d4951f",
      "name": "Get User Facebook",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        448,
        448
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "b3c0396b-3cf5-4a96-8c88-f91e4e009c56",
      "name": "Get User Facebook1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        464,
        768
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not client"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fea13891-5065-4d09-807e-5ce6aabc432a",
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "is client"
            }
          ]
        },
        "options": {}
      },
      "id": "77896819-ef52-44c4-a9d3-9ff63be150dc",
      "name": "Switch4",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        912,
        448
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook1').item.json.participants.data[0].email }}\",\n      \"body\": \"Dear {{ $json.participants.data[0].name }},\\nI’m reaching out regarding the email address you provided. Unfortunately, it appears that the email is incomplete or missing. Could you kindly provide the correct email address at your earliest convenience? This will help us proceed with your request smoothly.\\n Thank you for your understanding and cooperation. Please let me know if you need any assistance with this.\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook1').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3758bffe-8d3c-48b7-80a7-a1069a494f93",
      "name": "Post message lên workchat from admin1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1472,
        784
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n      \"body\": \"Hello {{ $('Get User Facebook').item.json.participants.data[0].name }}, \\nTo provide you with the best support possible, we've created a new client account for you on our system. Please login using the email we've registered for you. For security reasons, we recommend setting a new password upon your first login. You can do this by visiting our website and following the instructions for 'Forgot Password' if needed.\\nUsername: {{ $('Take mail1').item.json.Email }} \\nPassword: qK8|*E04J}06 \\nVisit our system: https://worksuite.cloodo.com/ \\nIf you have any questions during the process, feel free to reach out for assistance.\\nThank you for working with us!\\nLet me know if there's anything else you need or if there's any other way I can assist you!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6d5b1a12-7c36-4a62-8ea0-6548020bffea",
      "name": "Post message lên workchat from admin2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2112,
        368
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n      \"body\": \"Thank you for providing the details. We’ve successfully received the information you’ve provided, and everything seems to be in order.\\nIn order to assist you further, could you kindly clarify the issue you are encountering? Please provide as much detail as possible so we can resolve it efficiently.\\nWe’re here to help, and we look forward to your response.\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1c0aba9f-8a7d-462f-b37c-abc6ded63a5e",
      "name": "Post message lên workchat from admin3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1824,
        560
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6b644bb8-682b-44b4-a084-2477f68b2219",
      "name": "Get User Facebook2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1680,
        1424
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"Hi {{ $('Get User Facebook2').item.json.participants.data[0].name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "2777f976-b540-4c64-aa05-38b705568cfc",
      "name": "Post message lên workchat from admin4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2720,
        1424
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Code9').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6d512f8f-bca4-4281-ac96-3e69e65d6a52",
      "name": "Post message lên workchat from admin5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3024,
        1632
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "587ec149-5360-42e4-975c-a4f1210d55f7",
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "welcome",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "welcome"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9dcadeba-3b70-4df1-bd15-804112cfaf26",
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "unclear problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "unclear problem"
            }
          ]
        },
        "options": {}
      },
      "id": "58d78e15-9fdf-4adb-b385-41581e580c24",
      "name": "Switch5",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1888,
        1424
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI5']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/###/g, '');\n  messagerAI = messagerAI.replace(/\\**/g, '');\n  messagerAI = messagerAI.replace(/\"/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "2c6605b3-c383-4d28-86c5-d6d594dc022e",
      "name": "Get Info Issue",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2464,
        1184
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"MESSAGE_TAG\",\n  \"tag\": \"ACCOUNT_UPDATE\",\n  \"message\": {\n    \"text\": \"{{ $json.output }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "18492926-7012-4884-a8a4-b4bc789d4775",
      "name": "send welcome3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2752,
        1152
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Get Info Issue').item.json.message }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "11d547f3-213d-431c-8fd0-107ed791c713",
      "name": "Post message lên workchat from admin6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3008,
        1008
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_AVeiW0a2XaMvsu5SwqARpYN6",
          "mode": "list",
          "cachedResultName": "Cmsmart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=You are a customer request analyst and an administrator named Cmsmart Ecommerce is talking to a customer in a friendly manner. The customer has given a request in the message below and the problem is not clear, analyze it according to the following requirements:\n- Analyze the customer's problem\n- Restate the customer's problem\n- Ask the customer to provide more missing information\nThen combine the above ideas and reply to the customer with a short message combining the above ideas in a friendly manner.\nHere is the message information you need to analyze to send a message to the customer:\n{{ $('Get All Messages7').item.json.messagesSent }}",
        "options": {}
      },
      "id": "4964e0db-e36e-4c11-a65a-6d4d81a5a7ab",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        2032,
        1648
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client4').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client4').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client4').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client4').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "42a83a6a-c77c-4a7f-bca9-c99ea7096993",
      "name": "MySQL Get Detail Messages3",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        1200,
        1968
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "e44e73d8-b698-437a-bbd6-a7647b3c4fe0",
      "name": "MySQL Get Info Client4",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        992,
        1968
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "423263b9-ffca-469d-a5d2-a3fc6d7f4b56",
      "name": "Aggregate15",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1424,
        1968
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate15']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "554b647c-ef43-46c4-80c2-5d756c035f5a",
      "name": "Get All Messages9",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        1968
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "8244194e-dcb5-4000-aa08-2cb558f9a169",
      "name": "Get User Facebook3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2672,
        1968
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook3').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Code13').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook3').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "73ea037c-3211-48ea-b502-5dafa76e442a",
      "name": "Post message lên workchat from admin7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4112,
        1952
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client5').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client5').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client5').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client5').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "33c55da5-f1d9-433b-9acd-2b727f464b19",
      "name": "MySQL Get Detail Messages4",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        1952,
        2992
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "9566ef95-37dc-4bfa-a99c-7157ec4cb4d1",
      "name": "MySQL Get Info Client5",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        1680,
        2992
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "87eb2b58-ed4c-4470-bb14-dcbeff3fe77c",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2192,
        2992
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.slice(0,30).reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "74474620-9288-4705-ad2f-48f7bb7b0930",
      "name": "Get All Messages",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        2992
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "13ef3de7-e702-4ef7-a23b-0ed46a35c4ba",
      "name": "Get User Facebook4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1648,
        3312
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook4').item.json.participants.data[0].email }}\",\n      \"body\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project2').item.json.data.id }}/\\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook4').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3b9d0c42-392c-4843-a4b3-8f6d7b55dbfc",
      "name": "Post message lên workchat from admin8",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1840,
        3312
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "62cefb73-621c-432f-b77e-62d23acdb51f",
      "name": "Get User Facebook5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3904,
        2992
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook5').item.json.participants.data[0].email }}\",\n      \"body\": \"I hope you're doing well! 😊\\nIt looks like you're working on {{ $('Get Project support1').item.json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\\nLooking forward to hearing from you!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook5').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "67a359da-02e9-40fd-ae3a-a9f82984c89b",
      "name": "Post message lên workchat from admin9",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4112,
        2992
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client6').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client6').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client6').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client6').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "28e9d97a-4959-46b9-b874-312ea0464015",
      "name": "MySQL Get Detail Messages5",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -3184,
        1312
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "cbd91b93-47a3-4d9b-9dba-25946e2fcaaf",
      "name": "MySQL Get Info Client6",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -3424,
        1312
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6f88ecfa-0b80-4d58-ba2b-cc2d85a1480d",
                    "leftValue": "={{ $json.message.content }}",
                    "rightValue": "normal",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "normal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.content }}",
                    "rightValue": "pricing",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pricing"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7f88dc66-34d6-43d7-a30a-42db27726ff4",
                    "leftValue": "={{ $json.message.content }}",
                    "rightValue": "service",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "service"
            }
          ]
        },
        "options": {}
      },
      "id": "03c8cf7c-4588-4593-831a-9002fbb27b0f",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2416,
        1312
      ]
    },
    {
      "parameters": {
        "jsCode": "const content = $input.all()[0].json.output;\n\n// Function to format text\nconst formatText = (text) => {\n    return text\n        .replace(/\\n/g, '<br>')  // Replace newlines with <br>\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')  // Bold (**text**)\n        .replace(/\\*(.*?)\\*/g, '<em>$1</em>')  // Italic (*text*)\n        .replace(/###\\s*(.*?)(\\n|$)/g, '<strong>$1</strong><br>')  // H3 (### text)\n        .replace(/\\[([^\\]]+)\\]\\((https?:\\/\\/[^\\)]+)\\)/g, '<a href=\"$2\" target=\"_blank\">$1</a>');  // Convert [text](link) to <a>\n};\n\n// Process content\nconst formattedContent = formatText(content);\n\n// Return as an object\nreturn {\n    formatted: formattedContent\n};\n"
      },
      "id": "5a172747-57f1-42a0-aa09-0cb77be4eebb",
      "name": "Get Info Issue1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1856,
        1728
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "dfea8f80-5818-4064-8f1c-3a6c1346052e",
      "name": "Aggregate16",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2976,
        1312
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('MySQL Get Info Client6').item.json.email.replaceAll(/@facebook.com/g, '') }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "b74c07bd-47e0-482d-92f0-0dfd8b26e92d",
      "name": "send welcome4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1504,
        1728
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('MySQL Get Info Client6').item.json.email }}\",\n      \"body\": \"{{ $('Code').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('MySQL Get Info Client6').item.json.name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "aab13789-880a-4187-955b-4223cc5c4df3",
      "name": "Post message lên workchat from admin10",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1296,
        1728
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['Get Info Issue1']?.json?.formatted\n  messagerAI = messagerAI.replace(/<br>/g, '\\\\n');\n  messagerAI = messagerAI.replace(/<em>/g, '');\n  messagerAI = messagerAI.replace(/<a>/g, '');\n  messagerAI = messagerAI.replace(/<\\/a>/g, '');\n  messagerAI = messagerAI.replace(/\"/g, '');\n   messagerAI = messagerAI.replace(/<a/g, '');\n   messagerAI = messagerAI.replace(/href=/g, '');\nmessagerAI = messagerAI.replace(/<strong>/g, '**');\n  messagerAI = messagerAI.replace(/<\\/strong>/g, '**');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "3fd1dd1c-c9b4-4b90-9a7b-e5670242bb05",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1696,
        1728
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4bb9b967-6da6-4da5-8357-aa32e68ecf85",
              "leftValue": "={{ $json.email_worksuit }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a69e20cd-0909-4f7f-9216-e82ec7d9d611",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1920,
        1280
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 2060972300,
          "mode": "list",
          "cachedResultName": "client_message_cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=2060972300"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_client_message",
              "lookupValue": "={{ $('Last send by client').item.json.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fd332a63-2874-4a74-8081-c1273b5daf52",
      "name": "Get Data Old Check",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2128,
        1280
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id_client_message || $json.id}}",
            "Company": "Cmsmart Ecommerce",
            "client": "={{ $json.id_client_message || $json.client }}",
            "client_name": "={{ $json.name_client_facebook || $json.client_name }}",
            "mailFacebook": "={{ $json.email_client_facebook || $json.mailFacebook}}",
            "email": "={{ $json.email_worksuit || $json.email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "fade51b4-6446-49c1-bc23-3d37fb93d625",
      "name": "Update Follow",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -640,
        1328
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"welcome\" or \"problem\" or \"unclear problem\" based on the problems the customer mentions needing support. If in the chat, the customer only states the problem and does not explain further, then the conclusion is \"unclear problem\". If in the chat, the customer only sends a greeting, then the conclusion is \"welcome\", but if the customer states the problem and explains the problem, then the conclusion is \"problem\". For example, if in the chat, the customer says: \"Hi, I just had a problem setting up the website... after installing and trying to edit or do anything, I keep getting a 503 error\" then the conclusion is \"problem\" because the customer explains that \"after installing and trying to edit or do anything, I keep getting a 503 error\"; If in the chat the customer says \"Hello, I want a refund\" then the conclusion is \"welcome\"; If in the chat the customer talks about an unclear issue then the conclusion is \"unclear problem\"\n\nJust return \"problem\" or \"welcome\" or \"unclear problem\" without explaining and adding any words.\nHere is the message information you need to analyze to come to a conclusion:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "9ca50fb1-b7b6-47ac-af82-a1a95b5bbc13",
      "name": "OpenAI3",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        1328,
        1424
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=You are an assistant of Cmsmart and you have been provided with most of the products as well as the prices of each item of each product of Cmsmart. Your job is in the following chat messages between customers and administrators. Focus on the most recent messages sent by customers, especially the last message, to determine the customer's intention. And with the data you have, provide information to customers in the most effective way.\n\nHere are the chat messages in history:\n\n{{ $('Get All Messages7').item.json.messagesSent }}\n\nWith the above data, only get the last information, see that information based on Cmsmart data\nThere is no general response to get the data about Cmsmart that you are provided\n\nSwitch to message format with Customer {{ $json.participants.data[0].name }} is canh and Sincerely Cmsmart Administrator\n\nReturn only starting from Dear and ending with Best Regard",
        "options": {}
      },
      "id": "baf834a0-86bb-4f86-be2f-ea2e82de33e9",
      "name": "OpenAI5",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        2048,
        1184
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Tracked4').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not_comfirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bd6d7b3a-906e-4c37-8d1d-2297746652b3",
                    "leftValue": "={{ $('Get Tracked4').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirm"
            }
          ]
        },
        "options": {}
      },
      "id": "c95f3906-81d7-4f27-901d-eff3d3d72b9a",
      "name": "Switch6",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1360,
        2720
      ]
    },
    {
      "parameters": {},
      "id": "d8176705-f2b7-4c6e-95fd-701a10505077",
      "name": "Cloodo CRM",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        2608,
        2992
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are analyzing a chat conversation between an agent and a client. \nFocus on analyzing the last messages sent by customers to know what the customer wants? Do they want to continue the conversation? Based on the sending time to know which is the last message and which is the current chat session. In each chat session, the time between messages is not more than 30 minutes, if more than 30 minutes, it is a new chat session.\n\nChat messages:\n{{ $json?.data?.slice(0,10).reverse().map(item => \n    item?.user_one == 62844 \n    ? `Admin sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n    : `Client sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n).join('') }}\n\nDetermine if the customer's question is about the price of a product. \n- If yes, return: \"pricing\"\n- If no, return: \"normal\"\n\nDetermine if the customer's question is about the information about we service. \n- If yes, return: \"service\"\n- If no, return: \"normal\"\n\nAlways Returns only one of the 3 keywords \"pricing\" or \"normal\" or \"service\". Do not provide any explanation.",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "420d2f12-da4f-4809-b04d-3e42c59a410b",
      "name": "OpenAI9",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2784,
        1312
      ]
    },
    {
      "parameters": {
        "errorMessage": "mail fb"
      },
      "id": "ab116a31-dce0-4b1e-badf-90bd3000161e",
      "name": "Stop and Error",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1216,
        1008
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $('Last send by client').item.json.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ed1059e4-71e8-4f82-92b9-9cca610c7199",
      "name": "Check Follow1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1680,
        1424
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4bb9b967-6da6-4da5-8357-aa32e68ecf85",
              "leftValue": "={{ $json.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "7df39121-35c4-495b-a7a2-3dbf54483b12",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1440,
        1424
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=ALWAYS use plain text and simple bullet points if clear and friendly communication is required. Do not apply any text effects such as bold, italics or headings. Keep the message simple, easy to understand and read.\n\nAct as a LiveChat AI Assistant\n\nUse the data I provide below dynamically in a way that helps analyze the customer's needs and provide personalized responses, but do not directly repeat the data to the customer. You must leverage the information you have provided to inform the conversation flow and provide useful, insightful responses based on the customer's context.\n\nClient Project Information\nProject Name: {{ $('Edit Fields1').item.json.project.name }}\nProject Status: {{ $('Edit Fields1').item.json.project.status }}\nStart Date: {{ $('Edit Fields1').item.json.project.start_date }}\nDeadline: {{ $('Edit Fields1').item.json.project.deadline }}\nProject Members: {{ $('Edit Fields1').item.json.project.members.map(item=> item.name) }}\n\nClient Information:\nName: {{ $('Edit Fields1').item.json.client.name }}\nEmail: {{ $('Edit Fields1').item.json.client.email }}\nMobile: {{ $('Edit Fields1').item.json.client.mobile }}\n\nHistorical chat messages:\n{{ $('Edit Fields1').item.json.messagesSent }}\n\nRespond to the customer's question. Focus on the last message the customer sent to give the best answer to the customer\n\nFinal notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on the customer's needs (project creation, support ticket, project information, new features, or refund).\nUse the project information you provide dynamically to create a response, making sure you don't repeat the data verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points to communicate clearly and friendly. Do not apply any text effects, such as bold, italics, or titles. Keep the message simple, clear, and easy to read.\nAvoid phrases that suggest you are an AI Assistant",
        "options": {}
      },
      "id": "a7968409-a6f3-448c-a4bf-8ad67f89f103",
      "name": "OpenAI7",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        3312,
        1952
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v22.0/213439902114044/messages",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "recipient",
              "value": "={\"id\":\"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"}"
            },
            {
              "name": "messaging_type",
              "value": "MESSAGE_TAG"
            },
            {
              "name": "tag",
              "value": "ACCOUNT_UPDATE"
            },
            {
              "name": "message",
              "value": "={\"text\":\"Hello {{ $('Get User Facebook2').item.json.participants.data[0].name }},\\n\\nBased on our conversation, to be able to better support you. You can check and track anytime here:\\n\\n🔹 Login Details:\\n\\nUsername: {{ $('Get Tracked3').item.json.email }}\\nIf you don't have an account, you can create one with your email here: https://cmsmart.net/login?view=registration\\nIf you forgot your password, reset it here: https://cmsmart.net/login?view=reset\\nIf you have any questions, please email support@cmsmart.net or chat with Vincent on WhatsApp:\\n📩 WhatsApp: https://wa.me/+84967319788\\n\\nI've also created an account for you on 🔗 https://worksuite.cloodo.com.\\nThis is my client's project management and ticketing website. Please visit the link above with your login information:\\n- **Username:** {{ $('Get Tracked3').item.json.email }} \\n- **Password:** x7M&dL!9wQ#2tV4%\\n\\nWhen you log in, you need to change your personal information and password, Click on transfer company to CmsMart. If you forget your password or need to change it, you can reset it via the following link:\\n🔗 [Reset Password](https://worksuite.cloodo.com/forgot-password)\\n\\nIf you have any other questions, please contact us.\\n\\nLet us know if you need more information! 😊\\n\\nSincerely,\\nCmsmart e-commerce team\"}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "13f4f2f9-ff8e-4ce4-82ae-5a5026236b83",
      "name": "send fb",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2992,
        1200
      ],
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"Hello {{ $('Get User Facebook2').item.json.participants.data[0].name }},\\n\\nBased on our conversation, to be able to better support you. You can check and track anytime here:\\n\\n🔗 Cmsmart Dashboard Support Ticket:\\nhttps://dashboard.cmsmart.net/apps/tickets/all-tickets\\n\\n🔹 Login Details:\\n\\nUsername: {{ $('Get Tracked3').item.json.email }}\\nIf you don't have an account, you can create one with your email here: https://cmsmart.net/login?view=registration\\nIf you forgot your password, reset it here: https://cmsmart.net/login?view=reset\\nIf you have any questions, please email support@cmsmart.net or chat with Vincent on WhatsApp:\\n📩 WhatsApp: https://wa.me/+84967319788\\n\\nI've also created an account for you on 🔗 https://worksuite.cloodo.com.\\nThis is my client's project management and ticketing website. Please visit the link above with your login information:\\n- **Username:** {{ $('Get Tracked3').item.json.email }} \\n- **Password:** x7M&dL!9wQ#2tV4%\\n\\nWhen you log in, you need to change your personal information and password, Click on transfer company to CmsMart. If you forget your password or need to change it, you can reset it via the following link:\\n🔗 [Reset Password](https://worksuite.cloodo.com/forgot-password)\\n\\nIf you have any other questions, please contact us.\\n\\nLet us know if you need more information! 😊\\n\\nSincerely,\\nCmsmart e-commerce team\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6171201b-badc-4ce3-b016-b3ced90bb9d8",
      "name": "Post message lên workchat from admin11",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3200,
        1200
      ],
      "disabled": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.email_worksuit }}",
                    "rightValue": "@facebook.com",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "worksuit facebook"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3554cbff-6398-49f0-91e0-05414af04904",
                    "leftValue": "={{ $json.email_worksuit }}",
                    "rightValue": "@facebook.com",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "worksuit email"
            }
          ]
        },
        "options": {}
      },
      "id": "8c694ea2-86e5-4ac6-b070-09b1a5f26935",
      "name": "Check mail old facebook",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1168,
        1248
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=You are AI Assistant represents David Nguyen, CEO of Cmsmart, a division of Netbase JSC, with extensive experience in eCommerce solutions for businesses worldwide. As a LiveChat agent, the assistant’s primary role is to engage customers naturally, offer expert consultancy, and support them in integrating Cmsmart’s WordPress and WooCommerce-based solutions efficiently.\n\n✅ The chat should emulate a real consultant, maintaining a natural, friendly, and engaging tone. ✅ Actively provide relevant information tied to Cmsmart’s offerings—including demos, case studies, and product resources. ✅ Encourage action (CTA): Assist clients in setting up their solutions, discuss available features, and connect them with full-service packages through Account Managers.\n\nLiveChat Workflow & Engagement Strategy\n\n1️⃣ Natural & Insightful Client Engagement\n\n✅ Greet & Identify Needs Naturally:\n\n“Hi there! 👋 Welcome to Cmsmart. How can I assist you today? Are you looking to develop a full eCommerce solution, integrate multi-vendor features, or enhance functionality with plugins?”\n“What kind of eCommerce solutions are you considering? Do you need multi-vendor capabilities or specific WooCommerce enhancements?”\n✅ Understand Pain Points & Recommend Cmsmart Solutions:\n\nCustomer: “I need a multi-vendor setup.”\nAgent: “Fantastic choice! Cmsmart can configure a multi-vendor store using tools like Dokan, ensuring complete setup and management. Would you like to know more about the specific features we offer?”\n✅ Encourage Action with a Clear CTA:\n\n“To move forward, your Account Manager will discuss the best setup for your needs. Would you like them to reach out and provide further details?”\n“Upgrading to our comprehensive eCommerce solution comes with added features for scalability and management. Are you interested in exploring these options?”\n2️⃣ Handling WooCommerce Solutions & Feature Integrations 🚀\n\nCmsmart’s Solutions: ✅ Expertise in WordPress and WooCommerce platform development ✅ Full integration of custom features with a seamless setup ✅ Multi-vendor store configurations with comprehensive support\n\n🔹 LiveChat Strategy:\n\n“To unlock advanced features, our team can provide a detailed walkthrough. Would you be interested in a scheduled call to explore these possibilities?”\n“With our specialized packages, you gain full setup and configuration advantages. Ready to learn more?”\n3️⃣ Common Customer Scenarios & How to Handle Them:\n\n🟢 Scenario 1: New to eCommerce, Needs a Store Setup:\n\nCustomer: “I want to start an online store with WordPress.”\nAgent: “Great choice! Cmsmart specializes in tailoring WordPress solutions for eCommerce. We can handle the full setup, from theme selection to plugin integration. Would you like our team to guide you through the process?”\n🟢 Scenario 2: Existing Store Needs Enhanced Features:\n\nCustomer: “Can you enhance my WooCommerce store with custom features?”\nAgent: “Absolutely! We can add custom functionalities to your WooCommerce store, ensuring they align with your business goals. Shall we discuss the specific features you’re interested in?”\n4️⃣ Handling Technical Support Requests:\n\n✅ When a current client reports an issue, follow these steps:\n\nAsk follow-up questions to comprehend the problem.\nProvide immediate guidance if available.\nDirect the client to the support ticket system for detailed assistance.\n💬 Example:\n\nCustomer: “My store’s checkout is buggy.”\nAgent: “I’d love to help! Is this affecting specific payment methods, or is it more general? If this requires deeper investigation, our project team can assist you directly. Can I document your issue for them to review?”\n5️⃣ LiveChat Agent Personality & Tone:\n\n✅ Be Human & Consultative – Engage like a friendly consultant. ✅ Proactively Engage – Ask clarifying questions to offer tailored advice. ✅ Always Connect to Cmsmart Services – Guide clients through the value that Cmsmart offers. ✅ Encourage Installations, Customizations, and Full-Service Solutions.\n\n6️⃣ Direct Contact & Support Channels 📞\n\nNeed support? Contact us anytime via email: support@cmsmart.com.\n\nSummary:\n\n✅ Facilitate seamless Cmsmart solution integrations ✅ Drive installation and enhancements of eCommerce capabilities ✅ Assist users with technical queries effectively ✅ Ensure the chat maintains a personal consulting feel, driving conversations towards service integrations and solutions tailored for client success.\n\n\nBelow is list chat messages. Let analysis it and answer customer.\n1. Client Info:\nName: {{ $('Last send by client').item.json.from.name }}\n\n2. Chat messages:\n{{ $('Aggregate14')?.item?.json?.data?.slice(0,10).reverse().map(item => \n    item?.user_one == 62844 \n    ? `Admin sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n    : `Client sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n).join('') }}\n\nREMEMBER THAT You are AI Assistant represents David Nguyen, make the best and friendly answer for client.\n\nThe length of the output must be less than or equal to 1500",
        "options": {}
      },
      "id": "f102561a-538f-498b-acea-3fef76c77120",
      "name": "OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=You are AI Assistant represents David Nguyen, CEO of Cmsmart, a division of Netbase JSC, with extensive experience in eCommerce solutions for businesses worldwide. As a LiveChat agent, the assistant’s primary role is to engage customers naturally, offer expert consultancy, and support them in integrating Cmsmart’s WordPress and WooCommerce-based solutions efficiently.\n\n✅ The chat should emulate a real consultant, maintaining a natural, friendly, and engaging tone. ✅ Actively provide relevant information tied to Cmsmart’s offerings—including demos, case studies, and product resources. ✅ Encourage action (CTA): Assist clients in setting up their solutions, discuss available features, and connect them with full-service packages through Account Managers.\n\nLiveChat Workflow & Engagement Strategy\n\n1️⃣ Natural & Insightful Client Engagement\n\n✅ Greet & Identify Needs Naturally:\n\n“Hi there! 👋 Welcome to Cmsmart. How can I assist you today? Are you looking to develop a full eCommerce solution, integrate multi-vendor features, or enhance functionality with plugins?”\n“What kind of eCommerce solutions are you considering? Do you need multi-vendor capabilities or specific WooCommerce enhancements?”\n✅ Understand Pain Points & Recommend Cmsmart Solutions:\n\nCustomer: “I need a multi-vendor setup.”\nAgent: “Fantastic choice! Cmsmart can configure a multi-vendor store using tools like Dokan, ensuring complete setup and management. Would you like to know more about the specific features we offer?”\n✅ Encourage Action with a Clear CTA:\n\n“To move forward, your Account Manager will discuss the best setup for your needs. Would you like them to reach out and provide further details?”\n“Upgrading to our comprehensive eCommerce solution comes with added features for scalability and management. Are you interested in exploring these options?”\n2️⃣ Handling WooCommerce Solutions & Feature Integrations 🚀\n\nCmsmart’s Solutions: ✅ Expertise in WordPress and WooCommerce platform development ✅ Full integration of custom features with a seamless setup ✅ Multi-vendor store configurations with comprehensive support\n\n🔹 LiveChat Strategy:\n\n“To unlock advanced features, our team can provide a detailed walkthrough. Would you be interested in a scheduled call to explore these possibilities?”\n“With our specialized packages, you gain full setup and configuration advantages. Ready to learn more?”\n3️⃣ Common Customer Scenarios & How to Handle Them:\n\n🟢 Scenario 1: New to eCommerce, Needs a Store Setup:\n\nCustomer: “I want to start an online store with WordPress.”\nAgent: “Great choice! Cmsmart specializes in tailoring WordPress solutions for eCommerce. We can handle the full setup, from theme selection to plugin integration. Would you like our team to guide you through the process?”\n🟢 Scenario 2: Existing Store Needs Enhanced Features:\n\nCustomer: “Can you enhance my WooCommerce store with custom features?”\nAgent: “Absolutely! We can add custom functionalities to your WooCommerce store, ensuring they align with your business goals. Shall we discuss the specific features you’re interested in?”\n4️⃣ Handling Technical Support Requests:\n\n✅ When a current client reports an issue, follow these steps:\n\nAsk follow-up questions to comprehend the problem.\nProvide immediate guidance if available.\nDirect the client to the support ticket system for detailed assistance.\n💬 Example:\n\nCustomer: “My store’s checkout is buggy.”\nAgent: “I’d love to help! Is this affecting specific payment methods, or is it more general? If this requires deeper investigation, our project team can assist you directly. Can I document your issue for them to review?”\n5️⃣ LiveChat Agent Personality & Tone:\n\n✅ Be Human & Consultative – Engage like a friendly consultant. ✅ Proactively Engage – Ask clarifying questions to offer tailored advice. ✅ Always Connect to Cmsmart Services – Guide clients through the value that Cmsmart offers. ✅ Encourage Installations, Customizations, and Full-Service Solutions.\n\n6️⃣ Direct Contact & Support Channels 📞\n\nNeed support? Contact us anytime via email: support@cmsmart.com.\n\nSummary:\n\n✅ Facilitate seamless Cmsmart solution integrations ✅ Drive installation and enhancements of eCommerce capabilities ✅ Assist users with technical queries effectively ✅ Ensure the chat maintains a personal consulting feel, driving conversations towards service integrations and solutions tailored for client success.\n\n\nBelow is list chat messages. Let analysis it and answer customer.\n1. Client Info:\nName: {{ $('Last send by client').item.json.from.name }}\n\n2. Chat messages:\n{{ $('Aggregate14')?.item?.json?.data?.slice(0,10).reverse().map(item => \n    item?.user_one == 62844 \n    ? `Admin sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n    : `Client sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n).join('') }}\n\nREMEMBER THAT You are AI Assistant represents David Nguyen, make the best and friendly answer for client.\n\nThe length of the output must be less than or equal to 1500",
        "options": {}
      },
      "id": "ca2bf027-938e-49f2-918f-f14b1398664a",
      "name": "OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2304,
        544
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=You are AI Assistant represents David Nguyen, CEO of Cmsmart, a division of Netbase JSC, with extensive experience in eCommerce solutions for businesses worldwide. As a LiveChat agent, the assistant’s primary role is to engage customers naturally, offer expert consultancy, and support them in integrating Cmsmart’s WordPress and WooCommerce-based solutions efficiently.\n\n✅ The chat should emulate a real consultant, maintaining a natural, friendly, and engaging tone. ✅ Actively provide relevant information tied to Cmsmart’s offerings—including demos, case studies, and product resources. ✅ Encourage action (CTA): Assist clients in setting up their solutions, discuss available features, and connect them with full-service packages through Account Managers.\n\nLiveChat Workflow & Engagement Strategy\n\n1️⃣ Natural & Insightful Client Engagement\n\n✅ Greet & Identify Needs Naturally:\n\n“Hi there! 👋 Welcome to Cmsmart. How can I assist you today? Are you looking to develop a full eCommerce solution, integrate multi-vendor features, or enhance functionality with plugins?”\n“What kind of eCommerce solutions are you considering? Do you need multi-vendor capabilities or specific WooCommerce enhancements?”\n✅ Understand Pain Points & Recommend Cmsmart Solutions:\n\nCustomer: “I need a multi-vendor setup.”\nAgent: “Fantastic choice! Cmsmart can configure a multi-vendor store using tools like Dokan, ensuring complete setup and management. Would you like to know more about the specific features we offer?”\n✅ Encourage Action with a Clear CTA:\n\n“To move forward, your Account Manager will discuss the best setup for your needs. Would you like them to reach out and provide further details?”\n“Upgrading to our comprehensive eCommerce solution comes with added features for scalability and management. Are you interested in exploring these options?”\n2️⃣ Handling WooCommerce Solutions & Feature Integrations 🚀\n\nCmsmart’s Solutions: ✅ Expertise in WordPress and WooCommerce platform development ✅ Full integration of custom features with a seamless setup ✅ Multi-vendor store configurations with comprehensive support\n\n🔹 LiveChat Strategy:\n\n“To unlock advanced features, our team can provide a detailed walkthrough. Would you be interested in a scheduled call to explore these possibilities?”\n“With our specialized packages, you gain full setup and configuration advantages. Ready to learn more?”\n3️⃣ Common Customer Scenarios & How to Handle Them:\n\n🟢 Scenario 1: New to eCommerce, Needs a Store Setup:\n\nCustomer: “I want to start an online store with WordPress.”\nAgent: “Great choice! Cmsmart specializes in tailoring WordPress solutions for eCommerce. We can handle the full setup, from theme selection to plugin integration. Would you like our team to guide you through the process?”\n🟢 Scenario 2: Existing Store Needs Enhanced Features:\n\nCustomer: “Can you enhance my WooCommerce store with custom features?”\nAgent: “Absolutely! We can add custom functionalities to your WooCommerce store, ensuring they align with your business goals. Shall we discuss the specific features you’re interested in?”\n4️⃣ Handling Technical Support Requests:\n\n✅ When a current client reports an issue, follow these steps:\n\nAsk follow-up questions to comprehend the problem.\nProvide immediate guidance if available.\nDirect the client to the support ticket system for detailed assistance.\n💬 Example:\n\nCustomer: “My store’s checkout is buggy.”\nAgent: “I’d love to help! Is this affecting specific payment methods, or is it more general? If this requires deeper investigation, our project team can assist you directly. Can I document your issue for them to review?”\n5️⃣ LiveChat Agent Personality & Tone:\n\n✅ Be Human & Consultative – Engage like a friendly consultant. ✅ Proactively Engage – Ask clarifying questions to offer tailored advice. ✅ Always Connect to Cmsmart Services – Guide clients through the value that Cmsmart offers. ✅ Encourage Installations, Customizations, and Full-Service Solutions.\n\n6️⃣ Direct Contact & Support Channels 📞\n\nNeed support? Contact us anytime via email: support@cmsmart.com.\n\nSummary:\n\n✅ Facilitate seamless Cmsmart solution integrations ✅ Drive installation and enhancements of eCommerce capabilities ✅ Assist users with technical queries effectively ✅ Ensure the chat maintains a personal consulting feel, driving conversations towards service integrations and solutions tailored for client success.\n\n\nBelow is list chat messages. Let analysis it and answer customer.\n1. Client Info:\nName: {{ $('Last send by client').item.json.from.name }}\nEmail: {{ $('Last send by client').item.json.from.email }}\n\n2. Chat messages:\n{{ $('Aggregate16').item.json.data.slice(0,10).reverse().map(item => \n    item?.user_one == 62844 \n    ? `Admin sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n    : `Client sent: ${item?.message || \"No message\"}\\nTime Send:  ${item?.created_at || \"No message\"}\\n\\n`\n).join('') }}\n\nREMEMBER THAT You are AI Assistant represents David Nguyen, make the best and friendly answer for client.",
        "options": {}
      },
      "id": "68177eda-e926-4344-a115-a2ec3f6f7e9f",
      "name": "OpenAI10",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2224,
        1568
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=I would appreciate if you can give theme download link asap",
        "options": {}
      },
      "id": "4d658815-9585-4804-88a9-23943802ae84",
      "name": "OpenAI8",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2736,
        400
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "facebook",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -5088,
        1328
      ],
      "id": "d2b432e1-9b02-4304-943f-5d1b54c0a44e",
      "webhookId": "fe34bf1a-5003-4f32-a42c-80177f0377c9"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "xd9eTvLAhhxEIHBD",
          "mode": "list",
          "cachedResultName": "AI Messager - Reply V1"
        },
        "options": {}
      },
      "id": "d05eba68-a937-4b61-95b1-0e22904ba355",
      "name": "Workflow Reply mesager",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        -4496,
        1088
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"problem\" or \"email\" based on the content that the customer mentions needing support.\n\nIf in the conversation, the customer only states the problem and does not explain further or the customer explains, then the conclusion is \"problem\"\nIf in the conversation, in the most recent message, the customer sends information including email, then the conclusion is \"email\". For example, if in the conversation, the customer talks about the problem of anything that does not have email in it, then the conclusion is \"problem\"; If in the conversation, the customer talks about information including email, then the conclusion is \"email\".\n\nJust conclude \"problem\" or \"email\" without further explanation.\nHere is the message information you need to analyze to draw conclusions:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "7bf826d4-9ed2-43d7-bf44-7ae68e218e29",
      "name": "OpenAI4",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -720,
        464
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Get Detail list Chat User6": {
      "main": [
        [
          {
            "node": "check cms send",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Detail Last list Chat User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Execute Workflow Trigger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          },
          {
            "node": "Workflow Reply mesager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail Last list Chat User": {
      "main": [
        [
          {
            "node": "Last send by client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by client": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome2": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "remind mail": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send create account": {
      "main": [
        [
          {
            "node": "Append1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client2": {
      "main": [
        [
          {
            "node": "send create account",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client3": {
      "main": [
        [
          {
            "node": "send received email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send received email": {
      "main": [
        [
          {
            "node": "Append3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append3": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take mail1": {
      "main": [
        [
          {
            "node": "mail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mail1": {
      "main": [
        [
          {
            "node": "Get User Facebook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User Facebook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Client Not Tracked Before": {
      "main": [
        [
          {
            "node": "Switch Quantity Project2",
            "type": "main",
            "index": 0
          },
          {
            "node": "MySQL Get Info Client",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked3": {
      "main": [
        [
          {
            "node": "Check Client Not Tracked Before",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome": {
      "main": [
        [
          {
            "node": "UP Level 1 - open1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 1 - open1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Require Project": {
      "main": [
        [
          {
            "node": "UP Level  2 create project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level  2 create project1": {
      "main": [
        [
          {
            "node": "Get User Facebook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code get list pro1": {
      "main": [
        [
          {
            "node": "Split Out8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - ask_project2": {
      "main": [
        [
          {
            "node": "Get Tracked4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Quantity Project2": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UP Level 3 - ask_project2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI6": {
      "main": [
        [
          {
            "node": "Get Project support1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - confirm_project": {
      "main": [
        [
          {
            "node": "Get User Facebook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project support1": {
      "main": [
        [
          {
            "node": "send message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message6": {
      "main": [
        [
          {
            "node": "UP Level 3 - confirm_project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked4": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "create_new_project1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "resolve_problem_ticket1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ask_info_project1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "take_care_client1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "summary_chat_session1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "send message7": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by Client2": {
      "main": [
        [
          {
            "node": "OpenAI7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User11": {
      "main": [
        [
          {
            "node": "Last send by Client2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code13": {
      "main": [
        [
          {
            "node": "send message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Get User Facebook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check cms send": {
      "main": [
        [
          {
            "node": "Code15",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code14": {
      "main": [
        [
          {
            "node": "Post message lên workchat from client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code15": {
      "main": [
        [
          {
            "node": "Post message lên workchat from client1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages": {
      "main": [
        [
          {
            "node": "Aggregate13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate13": {
      "main": [
        [
          {
            "node": "Get All Messages7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages7": {
      "main": [
        [
          {
            "node": "OpenAI3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages2": {
      "main": [
        [
          {
            "node": "Aggregate14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client2": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate14": {
      "main": [
        [
          {
            "node": "Get All Messages8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages8": {
      "main": [
        [
          {
            "node": "OpenAI4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Take mail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client3": {
      "main": [
        [
          {
            "node": "send welcome2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook1": {
      "main": [
        [
          {
            "node": "remind mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [],
        [
          {
            "node": "Update contact client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin2": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook2": {
      "main": [
        [
          {
            "node": "Switch5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin4": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin5": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch5": {
      "main": [
        [
          {
            "node": "OpenAI5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "send welcome",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Info Issue": {
      "main": [
        [
          {
            "node": "send welcome3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome3": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin6",
            "type": "main",
            "index": 0
          },
          {
            "node": "send fb",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin6": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Code9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages3": {
      "main": [
        [
          {
            "node": "Aggregate15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client4": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate15": {
      "main": [
        [
          {
            "node": "Get All Messages9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook3": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin7": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages4": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client5": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Get All Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook4": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook5": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages5": {
      "main": [
        [
          {
            "node": "Aggregate16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client6": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get Data Old Check",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Info Issue1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate16": {
      "main": [
        [
          {
            "node": "OpenAI9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome4": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Check mail old facebook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Follow1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data Old Check": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Follow": {
      "main": [
        [
          {
            "node": "Get Tracked2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI3": {
      "main": [
        [
          {
            "node": "Get User Facebook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI5": {
      "main": [
        [
          {
            "node": "Get Info Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Code get list pro1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MySQL Get Info Client5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI9": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Follow1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Update Follow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MySQL Get Info Client2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code9": {
      "main": [
        [
          {
            "node": "send welcome1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI7": {
      "main": [
        [
          {
            "node": "Code13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send fb": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin11": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check mail old facebook": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Follow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI10": {
      "main": [
        [
          {
            "node": "Get Info Issue1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "send welcome4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI4": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f51fb336-ed1e-48d9-b73b-ba98780f0ce8",
  "meta": {
    "instanceId": "df4234b863448d98c06954fc105387a22f1c95b8c489a38e4e0f273423fc25cd"
  },
  "id": "mxMao0DjrkcxwpoP",
  "tags": []
}